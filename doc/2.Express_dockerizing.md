# Express Dockerizing



## Dockerfile 작성

```dockerfile
FROM node:14.13.1-alpine
WORKDIR /app
ENV PATH /app/node_modules/.bin:$PATH
COPY . /app

RUN yarn config set strict-ssl false
RUN yarn install
RUN yarn build

ENV PORT 80

CMD ["yarn", "start"]
```



## .dockerignore 작성

```
node_modules
```



## Docker build

```bash
react_nodejs/backend$ docker build --build-arg http_proxy=http://70.10.15.10:8080 --build-arg https_proxy=http://70.10.15.10:8080 -t backend:1.0.0 .

Sending build context to Docker daemon  196.6kB
Step 1/9 : FROM node:14.13.1-alpine
---> 87e4e57acaa5
Step 2/9 : WORKDIR /app
---> Running in ee798302895b
Removing intermediate container ee798302895b
---> f728e7f3eeca
Step 3/9 : ENV PATH /app/node_modules/.bin:$PATH
---> Running in c8c1ce37b9e8
Removing intermediate container c8c1ce37b9e8
---> e969cc88bfaf
Step 4/9 : COPY . /app
---> f95efd3a6da4
Step 5/9 : RUN yarn config set strict-ssl false
---> Running in 79f0172c0d1b
yarn config v1.22.5
success Set "strict-ssl" to "false".
Done in 0.04s. 
Removing intermediate container 79f0172c0d1b
---> 032d8b1311e8
Step 6/9 : RUN yarn install
---> Running in 8c53b40a87f1
yarn install v1.22.5
warning package-lock.json found. Your project contains lock files generated by tools other than Yarn. It is advised not to mix package managers in order to avoid resolution inconsistencies caused by unsynchronized lock files. To clear this warning, remove package-lock.json.
[1/4] Resolving packages...
[2/4] Fetching packages...
info fsevents@2.1.3: The platform "linux" is incompatible with this module.
info "fsevents@2.1.3" is an optional dependency and failed compatibility check. Excluding it from installation.
[3/4] Linking dependencies...
[4/4] Building fresh packages...
Done in 12.93s. 
Removing intermediate container 8c53b40a87f1 
---> 613ac6f31eec
Step 7/9 : RUN yarn build
---> Running in 81e7be8bff33 
yarn run v1.22.5
$ tsc
Done in 1.80s.
Removing intermediate container 81e7be8bff33 
---> fc66f9c2440c
Step 8/9 : EXPOSE 80 
---> Running in 432e8fc4f7c5
Removing intermediate container 432e8fc4f7c5 
---> 75e9d1178db3 
Step 9/9 : CMD ["yarn", "start"] 
---> Running in 2561c4bcd6a2
Removing intermediate container 2561c4bcd6a2
---> 76f590fcbfff 
Successfully built 76f590fcbfff
Successfully tagged backend:1.0.0 
```



### 도커 이미지 확인

```bash
react_nodejs/backend$ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
backend             1.0.0               76f590fcbfff        3 minutes ago       313MB 
frontend            1.0.0               033cef4ccb81        3 hours ago         21.1MB
```



## Docker run

```bash
react_nodejs/backend$ docker run -it -p 80:80 backend:1.0.0

yarn run v1.22.5
$ node dist/index.js
Server is listening on 80  
```



### Curl로 테스트

```powershell
PS C:\Users\xxx> curl http://localhost:80/hello/noname

StatusCode        : 200
StatusDescription : OK
Content           : {"hello":"noname"}
RawContent        : HTTP/1.1 200 OK
                    Connection: keep-alive
                    Keep-Alive: timeout=5
                    Content-Length: 18
                    Content-Type: application/json; charset=utf-8
                    Date: Tue, 03 Nov 2020 07:11:00 GMT
                    ETag: W/"12-dZF6auCLXeXrBhVdxPPl...
Forms             : {}
Headers           : {[Connection, keep-alive], [Keep-Alive, timeout=5], [Content-Length, 18], [Content-Type, applicatio
                    n/json; charset=utf-8]...}
Images            : {}
InputFields       : {}
Links             : {}
ParsedHtml        : mshtml.HTMLDocumentClass
RawContentLength  : 18
```



